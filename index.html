<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Super Mangonio Bros</title>
  <style>
    html, body {
      margin: 0; padding: 0; overflow: hidden; background: black;
      height: 100%;
    }
    canvas {
      display: block;
      background: black;
    }
  </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<audio id="bgm" loop autoplay>
  <source src="music.mp3" type="audio/mpeg" />
</audio>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let width = window.innerWidth;
let height = window.innerHeight;
canvas.width = width;
canvas.height = height;

const GRAVITY = 0.4;
const FLOOR = height - 64;

let keys = {};
let mouseClicked = false;
let gameStarted = false;
let gameOver = false;
let level = 1;
let cameraX = 0;
let lives = 3;

const images = {
  background: new Image(),
  mangonio: new Image(),
  enemy: new Image(),
  pipe: new Image(),
  minion: new Image(),
  coin: new Image()
};
images.background.src = "background.png";
images.mangonio.src = "mangonio.png";
images.enemy.src = "umpalumpa.png";
images.pipe.src = "tuberia.png";
images.minion.src = "minion.png";
images.coin.src = "monedas.png";

let player = {
  x: 50,
  y: 300,
  vx: 0,
  vy: 0,
  width: 32,
  height: 32,
  grounded: false,
  facing: "right"
};

let enemies = [];
let blocks = [];
let pipes = [];
let minions = [];
let goal = null;

document.addEventListener("keydown", e => {
  keys[e.key.toLowerCase()] = true;
  if (e.key.toLowerCase() === "q" && (!gameStarted || gameOver)) {
    gameStarted = true;
    gameOver = false;
    lives = 3;
    level = 1;
    resetLevel();
    bgm.play();
  }
});
document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);
document.addEventListener("mousedown", () => mouseClicked = true);
document.addEventListener("mouseup", () => mouseClicked = false);

function resetLevel() {
  player.x = 50;
  player.y = 300;
  player.vx = 0;
  player.vy = 0;
  player.facing = "right";
  cameraX = 0;

  enemies = [];
  blocks = [];
  pipes = [];
  minions = [];

  if (level === 1) {
    enemies = [
      { x: 600, y: FLOOR - 24, width: 24, height: 24, dir: 1, speed: 1 },
      { x: 900, y: FLOOR - 24, width: 24, height: 24, dir: -1, speed: 1 }
    ];
    blocks = [
      { x: 150, y: FLOOR - 32, width: 32, height: 32 },
      { x: 180, y: FLOOR - 64, width: 32, height: 32 },
      { x: 210, y: FLOOR - 96, width: 32, height: 32 }
    ];
    pipes = [
      { x: 700, y: FLOOR - 48, width: 64, height: 48 }
    ];
    minions = [
      { x: 700, y: FLOOR - 80, width: 32, height: 32 }
    ];
    goal = { x: 1300, y: FLOOR - 32, width: 32, height: 32 };
  } else if (level === 2) {
    enemies = [
      { x: 550, y: FLOOR - 24, width: 24, height: 24, dir: 1, speed: 1.2 },
      { x: 800, y: FLOOR - 24, width: 24, height: 24, dir: -1, speed: 1.2 },
      { x: 1100, y: FLOOR - 24, width: 24, height: 24, dir: 1, speed: 1.3 }
    ];
    blocks = [
      { x: 150, y: FLOOR - 32, width: 32, height: 32 },
      { x: 180, y: FLOOR - 64, width: 32, height: 32 },
      { x: 210, y: FLOOR - 96, width: 32, height: 32 },
      { x: 400, y: FLOOR - 32, width: 32, height: 32 },
      { x: 430, y: FLOOR - 64, width: 32, height: 32 }
    ];
    pipes = [
      { x: 700, y: FLOOR - 48, width: 64, height: 48 },
      { x: 1000, y: FLOOR - 48, width: 64, height: 48 }
    ];
    minions = [
      { x: 700, y: FLOOR - 80, width: 32, height: 32 },
      { x: 1000, y: FLOOR - 80, width: 32, height: 32 }
    ];
    goal = { x: 1400, y: FLOOR - 32, width: 32, height: 32 };
  } else if (level === 3) {
    enemies = [
      { x: 600, y: FLOOR - 24, width: 24, height: 24, dir: 1, speed: 1.5 },
      { x: 850, y: FLOOR - 24, width: 24, height: 24, dir: -1, speed: 1.7 },
      { x: 1100, y: FLOOR - 24, width: 24, height: 24, dir: 1, speed: 1.8 },
      { x: 1300, y: FLOOR - 24, width: 24, height: 24, dir: -1, speed: 1.6 }
    ];
    blocks = [
      { x: 150, y: FLOOR - 32, width: 32, height: 32 },
      { x: 180, y: FLOOR - 64, width: 32, height: 32 },
      { x: 210, y: FLOOR - 96, width: 32, height: 32 },
      { x: 400, y: FLOOR - 32, width: 32, height: 32 },
      { x: 430, y: FLOOR - 64, width: 32, height: 32 },
      { x: 900, y: FLOOR - 32, width: 32, height: 32 },
      { x: 930, y: FLOOR - 64, width: 32, height: 32 }
    ];
    pipes = [
      { x: 700, y: FLOOR - 48, width: 64, height: 48 },
      { x: 1000, y: FLOOR - 48, width: 64, height: 48 },
      { x: 1250, y: FLOOR - 48, width: 64, height: 48 }
    ];
    minions = [
      { x: 700, y: FLOOR - 80, width: 32, height: 32 },
      { x: 1000, y: FLOOR - 80, width: 32, height: 32 },
      { x: 1250, y: FLOOR - 80, width: 32, height: 32 }
    ];
    goal = { x: 1450, y: FLOOR - 32, width: 32, height: 32 };
  } else {
    alert("ðŸŽ‰ Â¡Completaste todos los niveles!");
    gameStarted = false;
    level = 1;
    resetLevel();
  }
}

function checkCollision(a, b) {
  return a.x < b.x + b.width && a.x + a.width > b.x &&
         a.y < b.y + b.height && a.y + a.height > b.y;
}

function drawRepeatingBackground() {
  const bgWidth = images.background.width;
  const bgHeight = images.background.height;
  let startX = Math.floor(cameraX / bgWidth) * bgWidth;
  for (let x = startX - bgWidth; x < cameraX + canvas.width; x += bgWidth) {
    // Dibuja la imagen background
    ctx.drawImage(images.background, x - cameraX, height - bgHeight, bgWidth, bgHeight);
  }
}

function update() {
  if (!gameStarted || gameOver) return;

  let left = keys["a"] || keys["arrowleft"];
  let right
